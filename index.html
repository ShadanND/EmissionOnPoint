<!-- File: index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Canadian Methane Measurement Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css">
  <style>
    html, body { height: 100%; margin: 0; }
    #header { background: #34495e; color: white; padding: 10px; text-align: center; position: relative; }
    #header img { position: absolute; left: 10px; top: 5px; height: 40px; }
    #canada-map { height: 85vh; }
    .province-info { position: absolute; top: 60px; right: 10px; background: white; padding: 10px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.3); width: 300px; display: none; z-index: 1000; }
    .province-info h3 { margin-top: 0; }
    .map-legend { position: absolute; bottom: 10px; left: 10px; background: white; padding: 10px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.3); z-index: 1000; }
  </style>
</head>
<body>

<div id="header">
  <img src="logo.png" alt="Logo">
  <h1>Canadian Methane Measurement Dashboard</h1>
</div>

<div id="canada-map"></div>
<div class="province-info" id="province-info">
  <h3 id="province-name">Province</h3>
  <div id="data-summary"></div>
  <div id="data-sources"></div>
  <button onclick="document.getElementById('province-info').style.display='none'">Close</button>
</div>
<div class="map-legend">
  <div><span style="background:#e74c3c;width:12px;height:12px;display:inline-block;margin-right:5px;"></span>Mobile</div>
  <div><span style="background:#3498db;width:12px;height:12px;display:inline-block;margin-right:5px;"></span>Stationary</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<script>
const provinceData = {
  Ontario: {
    name: "Ontario",
    dataSources: [
      { name: "Petrolia Mobile Measurements", type: "mobile", duration: "2023-2024", provider: "Petrolia Enviro", location: [42.8845, -82.1490] },
      { name: "Petrolia Stationary Sensor", type: "stationary", duration: "2023-2024", provider: "Petrolia Enviro", location: [42.8850, -82.1500] }
    ]
  },
  Alberta: {
    name: "Alberta",
    dataSources: [
      { name: "Medicine Hat Mobile Measurements", type: "mobile", duration: "2020-2024", provider: "Medicine Hat Climate Center", location: [50.0417, -110.6766] },
      { name: "Medicine Hat Stationary Sensor", type: "stationary", duration: "2020-2024", provider: "Medicine Hat Climate Center", location: [50.0400, -110.6750] }
    ]
  }
};

const map = L.map('canada-map').setView([56.1304, -106.3468], 4);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 18,
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

fetch('./canada_provinces.geo.json')
  .then(response => response.json())
  .then(geojsonData => {
    const geojsonLayer = L.geoJSON(geojsonData, {
      style: {
        color: "#34495e",
        weight: 1,
        fillOpacity: 0.2
      },
      onEachFeature: (feature, layer) => {
        layer.on('mouseover', () => {
          layer.setStyle({ fillOpacity: 0.5 });
          const provName = feature.properties.name || '';
          showProvinceInfo(provName);
        });
        layer.on('mouseout', () => {
          layer.setStyle({ fillOpacity: 0.2 });
        });
      }
    }).addTo(map);

    addDataSources();
  });

function showProvinceInfo(name) {
  const info = document.getElementById('province-info');
  const province = provinceData[name];
  if (!province) {
    info.style.display = 'none';
    return;
  }
  document.getElementById('province-name').innerText = province.name;
  document.getElementById('data-summary').innerText = `${province.dataSources.length} data sources`;
  const sourcesDiv = document.getElementById('data-sources');
  sourcesDiv.innerHTML = '';
  province.dataSources.forEach(src => {
    const div = document.createElement('div');
    div.innerHTML = `<strong>${src.name}</strong><br>Type: ${src.type}<br>Duration: ${src.duration}<br>Provider: ${src.provider}`;
    sourcesDiv.appendChild(div);
  });
  info.style.display = 'block';
}

function addDataSources() {
  Object.keys(provinceData).forEach(name => {
    const prov = provinceData[name];
    prov.dataSources.forEach(src => {
      const marker = L.circleMarker(src.location, {
        radius: 6,
        color: src.type === 'mobile' ? '#e74c3c' : '#3498db',
        fillOpacity: 0.8
      }).addTo(map);
      marker.bindPopup(`<strong>${src.name}</strong><br>Type: ${src.type}<br>Provider: ${src.provider}<br>Duration: ${src.duration}`);
    });
  });
}
</script>
</body>
</html>
